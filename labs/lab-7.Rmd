---
title: 'Lab 7: RMarkdown'
output:
  html_document:
    theme: cosmo
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# suppress scientific notation
options(scipen = 999)

library(ggplot2)
library(tidyverse)
library(DT)
library(dslabs)
library(tidyverse)

```

You can download an RMarkdown file of today's lab [here](lab-7.Rmd) and a PDF of today's lab [here](lab-7.pdf).

# Purpose

The purpose of today's lab is to get more familiar with RMarkdown. RMarkdown is a file format that allows us to produce reports. You can use RMarkdown to produce html files (as we have been doing), but also word documents, pdfs, slideshows, websites, and more. In 612, we will be using RMarkdown to create APA manuscripts in R. 

For more information about RMarkdown, I would recommend this [cheatsheet](https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf) and this [book](https://bookdown.org/yihui/rmarkdown/).

# YAML

The YAML is the header of your RMarkdown file that starts and ends with `---`.  When you open a new RMarkdown file, it will automatically create a default YAML with a title, author, date, and output. You can set the output to which file type you want the report to print out in (`html_document`, `pdf_document`, `word_document`, `ioslides_presentation`, etc.)

```yaml
---
title: Lab 7: RMarkdown
author: Sarah Dimakis
date: November 13, 2020
output: 
  html_document
---
```

For an html document, you can add a table of contents by specifying `toc: true` under the output. If you like how the table of contents is floating like it is on the course website, you can also add `toc_float: true`. Additionally, you can customize your theme, change the width and height of figures for the whole report, number your sections, and so on. For how to do these, refer [here](https://bookdown.org/yihui/rmarkdown/html-document.html).  

```yaml
---
title: 'Lab 7: RMarkdown'
output:
  html_document:
    toc: true
    toc_float: true
---
```

# Code chunks

You can create a new code chunk with the shortcut `Ctrl + Alt + I`  (or `Cmd + Option + I` if you have a Mac). 

```{r}

```

## Code chunk options

Code chunks have the default setting that all code will be evaluated and all code and results of the code will be printed out in your report when you knit it. But you may want to override the defaults. For example, you may want your final report to show **only** your figure but not the code that created the figure. You would edit the code chunk, inside the brackets, like this:


````markdown
`r ''````{r, echo = FALSE}
````

Here are some more options that I use often.

|Option          |Purpose                                               | Useful for...|
|:--------------|:------------------------------------------|:----------------------------------|
|`eval = FALSE`    |The code chunk will print but is not evaluated     |If you want to showcase sample code|
|`echo = FALSE`    |The results will print but not the code chunk     | If you want to hide your code |
|`include = FALSE` | The code chunk is evaluated but nothing is printed| You are loading libraries|
|`warning = FALSE` | Warning messages will not be displayed|You want to get rid of a warning message in your report but you still want it to print the rest of your results out (if it is not a warning message try `message = FALSE`)|
|`error = TRUE` | The error message will display in your report instead of in the console | You can use this to knit even when you have an error message|

Refer [here](https://bookdown.org/yihui/rmarkdown/r-code.html) for more options. To change the settings for every code chunk, you can set a global option. For example, if I wanted only the results and no code to print out for my entire report, I would put the code `knitr::opts_chunk$set(echo = FALSE)` in my first code chunk.


# Tables and tabbed sections  {.tabset .tabset-fade .tabset-pills}

Tabbed sections are a way to organize your html file a little better. In this section, we will also be exploring how to make a table using the `DT` package.

## Table 1

```{r, echo = FALSE}
#First, I'm going to create a table of the first 100 rows from the diamonds data set  
#The table will have 5 rows per page

#install.packages("DT")
head(ggplot2::diamonds, 100) %>% 
  DT::datatable(options = list(pageLength = 5))
```

## Table 2
```{r, echo = FALSE}
#This table adds a caption and removes the first row
DT::datatable(head(ggplot2::diamonds, 100), 
              caption = "Table 1. This is a dataset about diamonds.",
              rownames = FALSE,
              options = list(pageLength = 5))
```

## Table 3
```{r, echo = FALSE}
#This table adds a column filter
head(ggplot2::diamonds, 100) %>% 
  select(-c(x,y,z)) %>% 
  DT::datatable(caption = "Table 1. This table has column filters.",
              filter = 'bottom',
              rownames = FALSE,
              options = list(autoWidth = TRUE,
                             pageLength = 5))
```


## More resources

### The DT package
>Click [here](https://rstudio.github.io/DT/) for more information about customizing tables with the DT package.

### Summary Tables
>For summary tables, I recommend the `kable` function from the `knitr` package and functions from the `kableExtra` package. You can find  more resources [here](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html). The knitr::kable function can make very basic tables, and the kableExtra functions can style those tables. Using the kableExtra package, you can highlight rows, add a scroll box, edit column names, insert pictures, figures, or icons into your tables, and so on.

# Inline text

Inline text refers to text that is outside of code chunks. I am currently writing in inline text. In order to format the text that you write outside of code chunks, you have to abide by Markdown syntax. For example, you may want to **bold**, *italicize*, or ~~strikethrough~~ a word. You also may want to insert a list, table, headers, link, image, blockquote, or equation. Refer to the RMarkdown [cheatsheet](https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf) for how to format in Markdown syntax.


## Inline code

Sometimes you may want to code outside of a code chunk. The most common reason for this is to report answers in your inline text. For example, let's say you are writing a manuscript in R and you need to report the mean and standard deviation for a variable. You can calculate the mean and standard deviation of the variable in the code chunk, then call the answer in the in-line text. This will reduce human transfer errors. 

```{r}
#Descriptive stats for diamond price 

m_price <- mean(diamonds$price)

sd_price <- sd(diamonds$price)

range_price_low <- range(diamonds$price)[1]

range_price_high <- range(diamonds$price)[2]
```

Now, I can call the variables inline, like this: The price of diamonds ranged from `r range_price_low` to `r range_price_high` (*M* = `r m_price`, *SD* = `r sd_price`). 

You can do more than call a variable outside of the code chunks. For example, here is some code that I wrote to make the sentence look a little nicer. I am adding units (dollar signs), commas, and making sure that each number is rounded to two decimal places. When you code outside of the code chunks, the code becomes really difficult to read, so I recommend keeping complicated code inside of the code chunks.

```{r, echo = F, eval = F}
format(                       # this function makes numbers pretty for printing
  as.double(range_price_low), 
  nsmall = 2)
```

The price of diamonds ranged from \$`r format(as.double(range_price_low), nsmall = 2)` to \$`r format(as.double(range_price_high), nsmall = 2, big.mark = ",")` (*M* = \$`r format(m_price, big.mark = ",", nsmall = 2)`, *SD* = \$`r format(sd_price, big.mark= ",")`). 


# Knitting errors
Knitting errors are particularly frustrating error messages if you thought you were done with your project and the code had worked up to the point of knitting. Plus, the messages can be vague and confusing. Here's our advice:

* Knit early and knit often. If you're working on the homework, it's a good idea to knit at least once after every problem.

* When you get an error, you first want to try to locate where the error is. If you think you found it, you can comment out the entire code chunk by highlighting the code and typing `Ctrl + Shift + C` (or `Cmd + Shift + C` on a Mac), or you can change the code chunk options to `error = TRUE`. You should be able to knit now if the error message is coming from the code chunk that you just disabled. Otherwise, disable more code chunks, one at a time until it knits.

* Once you've established where the error is, you may still not understand why the code isn't working. The most common reasons are...
  + Your data set wasn't imported properly.
  + You haven't loaded the proper libraries and you need to add at least one `library()` command.
  + You are referring to a variable that hasn't been assigned yet. It probably worked before because it was assigned in your global environment, but it needs to be assigned before the line of code in order for it to knit.

# Minihacks

For today's minihacks, you will be using RMarkdown to create your own html file.

1. Open up a new RMarkdown file and erase everything but the YAML. Edit the YAML in the following ways:
    + Change the title to "Lab 7 Minihacks"
    + Remove your name and the date
    + Add a table of contents, numbered sections, and choose a theme. You should be outputting to an html file.  Some html themes you may want to try are `cerulean`, `journal`, `flatly`, `lumen`, `paper`, and `readable`.

2. Create a new code chunk and load the following libraries: `ggplot2 `, `tidyverse`, and `dslabs`. `dslabs` is a package for data science data sets. If you don't have it, then you need to first install it in your console window using the command `install.packages("dslabs")`. 
    + Change the default chunk option so that the code is evaluated, but neither the code nor any resulting messages will show up in your report.

3. Now, we are going to use the `us_contagious_diseases` data set from the `dslabs` package. It has the yearly counts for seven contagious diseases for the years 1928 - 2011. I have created three data frames and called them `data_1`, `data_2`, and `data_3`. 
    + Create a new heading called "Tables." 
    + Under the header, copy and paste the code for the three data frames into your new RMarkdown file.
    + Edit the code to print each data frame as a table using the `DT` package.
    + Add a caption to each table, edit the column names, and remove the row numbers. You will need to examine the code closely to figure out which each table represents. 
    + Change the chunk options so that you can only see the tables (not the code).


```{r, message = FALSE}
data_1 <- dslabs::us_contagious_diseases %>% 
  group_by(disease) %>% 
  summarise(sum_count = sum(count)) %>% 
  as.data.frame()
```

```{r, message = FALSE}
data_2 <- dslabs::us_contagious_diseases %>% 
  filter(disease == "Measles") %>% 
  group_by(year) %>% 
  summarise(sum_count = sum(count)) %>% 
  as.data.frame()
```

```{r}
data_3 <- dslabs::us_contagious_diseases %>% 
  filter(disease == "Measles" & year == "1938") %>%
  mutate(per_measles = count/population * 100) %>% 
  select(state, count, population, per_measles) %>% 
  as.data.frame()
```


4. Copy and paste the code for these three figures into your RMarkdown file. 
    + Reorganize the figures into a **tabbed** section called "Figures".
    + Change the default chunk options so that you can only see the figures (no code). 
    + Use chunk options to change the figure width to 8 inches.

```{r, eval = FALSE}
data_1 %>% 
  ggplot(aes(x = disease, y = sum_count)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(x = "Type of disease", y= "Death count") + 
  coord_flip()
```

```{r, eval = FALSE}
data_2 %>% 
  ggplot(aes(x = year, y = sum_count)) +
  geom_point() +
  theme_minimal() +
  labs(x = "Year", y= "Death count") +
  geom_vline(xintercept = 1963, color = "red", linetype = "dashed") + 
  geom_text(x = 1980, y = 600000, label = "Vaccine invented in 1963", 
            color = "red")
```

```{r, eval = FALSE}
#install.packages("maps")
library(maps)
data_3 <- data_3 %>% 
  mutate(region = tolower(state))
states_map <- map_data("state")
disease_map <- left_join(states_map, data_3, by = "region")
ggplot(disease_map, aes(long, lat, group= group)) +
  geom_polygon(aes(fill = per_measles), color = "white") +
  labs(fill = "% Measles") +
  theme_minimal()
```

5. Using in-line code, answer the following questions:
    + Which disease had the highest number of infections in the US during this time span? What was the number of infections?
    + What was the average number of Measles cases per year in the US from 1928 to 2011? Round this number to two decimal places.